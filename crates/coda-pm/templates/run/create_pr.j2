You are creating a pull request for a completed feature using the GitHub CLI (`gh`).

## Design Specification

{{ design_spec }}

## Development History

{% for commit in original_commits %}
- `{{ commit.sha }}` — {{ commit.message }}
{% endfor %}

## Execution Summary

- **Feature**: {{ state.feature.slug }}
- **Branch**: `{{ state.git.branch }}` → `{{ state.git.base_branch }}`
- **Model**: {{ model }}
- **Duration**: {{ state.total.duration_secs }}s
- **Cost**: ${{ state.total.cost_usd }}

### Phase Results
{% for phase in state.phases %}
- **{{ phase.name }}**: {{ phase.status }} ({{ phase.turns }} turns, ${{ phase.cost_usd }}, {{ phase.duration_secs }}s)
{% endfor %}

### Review Summary
- Rounds: {{ review_summary.rounds }}
- Issues found: {{ review_summary.issues_found }}
- Issues resolved: {{ review_summary.issues_fix_attempted }}

### Verification Summary
- Checks passed: {{ verification_summary.checks_passed }}/{{ verification_summary.checks_total }}
{% if not all_checks_passed %}
- **WARNING: Not all checks passed. PR will be created as draft.**
{% endif %}

## Task
{% if squashed %}

### 1. Commit the squashed changes

All feature changes have been squashed into the staging area. Create a **single commit** with a concise
conventional commit message that captures the core functionality of this feature (one line, under 72 characters).
Do NOT simply concatenate the original commit messages — write a fresh, concise summary.

```bash
git commit -m "feat({{ state.feature.slug }}): <concise core feature description>"
```

### 2. Push the branch

```bash
git push -u origin {{ state.git.branch }}
```

### 3. Create the PR using `gh` CLI
{% else %}

### 1. Push the branch

```bash
git push -u origin {{ state.git.branch }}
```

### 2. Create the PR using `gh` CLI
{% endif %}

Generate a **detailed** PR title and body, then create the PR:

**Title format**: `feat(<scope>): <concise description>`

```bash
gh pr create \
  --base "{{ state.git.base_branch }}" \
  --head "{{ state.git.branch }}" \
{% if is_draft %}
  --draft \
{% endif %}
  --title "feat({{ state.feature.slug }}): <concise description>" \
  --body "$(cat <<'PRBODY'
## Summary

<2-3 sentences: what this PR does, why it's needed, and the approach taken>

## Changes

<Group changes by area. Be specific — mention file names, function names, types added>

### <Area 1 — e.g. Core Types>
- Added `FooStruct` in `src/foo.rs` — <purpose>
- Implemented `BarTrait` for `Baz` — <purpose>

### <Area 2 — e.g. API Layer>
- New endpoint `POST /api/xxx` in `routes.rs`
- Updated `Config` to support new field `yyy`

### <Area 3 — e.g. Tests>
- Added unit tests for `FooStruct` (X tests)
- Added integration test for end-to-end flow

## Design Spec

See [\`.coda/{{ state.feature.slug }}/specs/design.md\`](.coda/{{ state.feature.slug }}/specs/design.md) for the full design specification.

## Verification

{% if all_checks_passed %}
- [x] All automated checks pass
{% for check in checks %}
  - [x] \`{{ check }}\`
{% endfor %}
- [x] Functional verification completed ({{ verification_summary.checks_passed }}/{{ verification_summary.checks_total }} checks passed)
{% else %}
- [ ] All automated checks pass ({{ verification_summary.checks_passed }}/{{ verification_summary.checks_total }} passed)
{% for check in checks %}
  - [ ] \`{{ check }}\`
{% endfor %}
- [ ] Functional verification incomplete — manual review required
{% endif %}
- [x] Code review completed ({{ review_summary.rounds }} round(s), {{ review_summary.issues_found }} issue(s) found, {{ review_summary.issues_fix_attempted }} fix(es) attempted)

## Test Plan

<Describe what was tested:>
- Unit tests: <count> tests covering <areas>
- Integration tests: <count> tests covering <scenarios>
- Edge cases tested: <list key edge cases>

## Development History

{% for commit in original_commits %}
- \`{{ commit.sha }}\` {{ commit.message }}
{% endfor %}

## Execution Stats

| Metric | Value |
|--------|-------|
| Model | {{ model }} |
| Total turns | {{ state.total.turns }} |
| Total cost | \${{ state.total.cost_usd }} |
| Duration | {{ state.total.duration_secs }}s |
| Review rounds | {{ review_summary.rounds }} |
| Issues found/fix attempted | {{ review_summary.issues_found }}/{{ review_summary.issues_fix_attempted }} |
| Checks passed | {{ verification_summary.checks_passed }}/{{ verification_summary.checks_total }} |

---

> Generated by **CODA** (Claude Orchestrated Development Agent) v{{ coda_version }}
> Model: {{ model }} | Cost: \${{ state.total.cost_usd }} | Duration: {{ state.total.duration_secs }}s

PRBODY
)"
```

### {{ "4" if squashed else "3" }}. Report the PR URL

After creating the PR, output the PR URL so it can be recorded in `state.yml`.

## Guidelines

- The PR body should be **comprehensive** — a reviewer should understand the full scope without reading every file
- Group changes logically, not just by file
- Mention any breaking changes, migration steps, or deployment considerations
- If any manual testing steps are needed, include them in the Test Plan
- Do NOT abbreviate — a detailed PR is always better than a sparse one
